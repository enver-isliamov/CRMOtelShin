
# –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (Vercel Native)

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:** "–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –º–∏—Ä—ã".
–ú—ã –ø–æ—Å—Ç—Ä–æ–∏–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –±—ç–∫–µ–Ω–¥–∞ (Node.js + –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Postgres) –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ Vercel. –û–Ω–∞ –±—É–¥–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ –æ—Ç —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã (Google Sheets).

–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É "—Å—Ç–∞—Ä—ã–º" (GAS) –∏ "–Ω–æ–≤—ã–º" (Vercel) –º–∏—Ä–æ–º –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

---

## üèõ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ (Legacy) | –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (Vercel Native) |
| :--- | :--- | :--- |
| **Frontend** | React (—à–ª–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ `script.google.com`) | –¢–æ—Ç –∂–µ React (—à–ª–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ `/api/crm`) |
| **Backend** | Google Apps Script | **Vercel Serverless Functions (Node.js)** |
| **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** | Google Sheets | **Vercel Postgres (SQL)** |
| **–§–∞–π–ª—ã** | Google Drive | **Google Drive** (—á–µ—Ä–µ–∑ GAS –∞–¥–∞–ø—Ç–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ) |
| **Telegram –ë–æ—Ç** | GAS (`doPost` webhook) | **Vercel API (`/api/bot`)** |

---

## ‚úÖ –≠–¢–ê–ü 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–í–´–ü–û–õ–ù–ï–ù–û)

1.  [x] –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç Vercel.
2.  [x] –ü–æ–¥–∫–ª—é—á–∏—Ç—å Vercel Postgres (Storage).
3.  [x] –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`POSTGRES_URL`).

---

## ‚úÖ –≠–¢–ê–ü 2: –°–æ–∑–¥–∞–Ω–∏–µ –ù–æ–≤–æ–≥–æ –ë—ç–∫–µ–Ω–¥–∞ (–í–´–ü–û–õ–ù–ï–ù–û)

1.  [x] **`package.json`**: –î–æ–±–∞–≤–ª–µ–Ω –¥—Ä–∞–π–≤–µ—Ä `@vercel/postgres` (–¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ Vercel).
2.  [x] **`api/setup.ts`**: –°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î (–¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ `/api/setup`).
3.  [x] **`api/crm.ts`**: –û—Å–Ω–æ–≤–Ω–æ–π —à–ª—é–∑ API –Ω–∞ Node.js.

---

## ‚úÖ –≠–¢–ê–ü 3: "–†—É–±–∏–ª—å–Ω–∏–∫" –Ω–∞ –§—Ä–æ–Ω—Ç–µ–Ω–¥–µ (–í–´–ü–û–õ–ù–ï–ù–û)

1.  [x] **`services/api.ts`**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É `GAS` –∏ `VERCEL` —Ä–µ–∂–∏–º–∞–º–∏.
2.  [x] **`components/Settings.tsx`**: –î–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

---

## ‚úÖ –≠–¢–ê–ü 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ü–µ—Ä–µ–µ–∑–¥ (–í–´–ü–û–õ–ù–ï–ù–û)

1.  [x] –î–µ–ø–ª–æ–π –Ω–∞ Vercel.
2.  [x] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î —á–µ—Ä–µ–∑ `/api/setup`.
3.  [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ ID).
4.  [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ë–î.

---

## üöö –≠–¢–ê–ü 5: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–ê–ö–¢–ò–í–ù–û)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∫–ª–∞–¥–∫—É "–ú–∏–≥—Ä–∞—Ü–∏—è" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤, –∞—Ä—Ö–∏–≤–∞ –∏ –º–∞—Å—Ç–µ—Ä–æ–≤ –∏–∑ Google Sheets –≤ Postgres.

---

## ü§ñ –≠–¢–ê–ü 6: –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–µ–∑–¥ –ë–æ—Ç–∞ (Vercel Native)

–°–µ–π—á–∞—Å –±–æ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ–≤–æ–π –±–∞–∑–æ–π, —Ç–∞–∫ –∫–∞–∫ –µ–≥–æ –∫–æ–¥ (`Bot.gs`) –æ—Å—Ç–∞–ª—Å—è –≤ Google –∏ –∏—â–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ.
–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞ –Ω–∞ Vercel.

### 6.1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (State Management)
–í Google Script –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `CacheService` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–µ–π—á–∞—Å –≤–≤–æ–¥–∏—Ç —Ç–µ–ª–µ—Ñ–æ–Ω"). –í Vercel (Serverless) –Ω–µ—Ç –ø–∞–º—è—Ç–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏. –ù–∞–º –Ω—É–∂–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞.

1.  **–û–±–Ω–æ–≤–∏—Ç—å `api/setup.ts`**: –î–æ–±–∞–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `bot_sessions`.
    ```sql
    CREATE TABLE IF NOT EXISTS bot_sessions (
        chat_id VARCHAR(50) PRIMARY KEY,
        state VARCHAR(100),
        data JSONB,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );
    ```

### 6.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Vercel
1.  –ó–∞–π—Ç–∏ –≤ Dashboard Vercel -> Settings -> Environment Variables.
2.  –î–æ–±–∞–≤–∏—Ç—å `TELEGRAM_BOT_TOKEN`: (–í–∑—è—Ç—å —É BotFather).
3.  –î–æ–±–∞–≤–∏—Ç—å `ADMIN_CHAT_ID`: (–í–∞—à ID –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö –∑–∞—è–≤–∫–∞—Ö).

### 6.3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API CRM (`api/crm.ts`)
–ù–∞—É—á–∏—Ç—å CRM –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è (—Å–µ–π—á–∞—Å –∫–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å SMS" –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ Vercel).
1.  –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `sendMessage(chatId, text)` –≤–Ω—É—Ç—Ä–∏ `api/crm.ts`.
2.  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `fetch` –¥–ª—è –≤—ã–∑–æ–≤–∞ `https://api.telegram.org/bot<TOKEN>/sendMessage`.

### 6.4. –°–æ–∑–¥–∞–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –ë–æ—Ç–∞ (`api/bot.ts`)
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª API, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å Webhook –æ—Ç Telegram.

1.  **–õ–æ–≥–∏–∫–∞ Webhook:** –ü—Ä–∏–Ω–∏–º–∞—Ç—å POST –∑–∞–ø—Ä–æ—Å—ã –æ—Ç Telegram.
2.  **–ü–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∏–∑ `Bot.gs`:** –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å JavaScript –∫–æ–¥ –Ω–∞ TypeScript/Node.js.
    *   –í–º–µ—Å—Ç–æ `SpreadsheetApp` -> –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã –∫ `pool` (`SELECT * FROM clients WHERE data->>'Chat ID' = $1`).
    *   –í–º–µ—Å—Ç–æ `CacheService` -> –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã –∫ `bot_sessions` (`INSERT ... ON CONFLICT DO UPDATE`).
    *   –í–º–µ—Å—Ç–æ `UrlFetchApp` -> –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—Ç–∏–≤–Ω—ã–π `fetch`.
3.  **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω—é:** –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é, –õ–ö, –ü—Ä–æ–¥–ª–µ–Ω–∏–µ (—á–µ—Ä–µ–∑ SQL UPDATE –∫–ª–∏–µ–Ω—Ç–æ–≤).

### 6.5. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ Webhook
–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞ –Ω—É–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å –¢–µ–ª–µ–≥—Ä–∞–º—É —Å–ª–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ Vercel.
1.  –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
    `https://api.telegram.org/bot<–í–ê–®_–¢–û–ö–ï–ù>/setWebhook?url=https://<–í–ê–®_–ü–†–û–ï–ö–¢>.vercel.app/api/bot`

### 6.6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1.  –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `/start`.
2.  –ü—Ä–æ–≤–µ—Ä–∏—Ç—å "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç" (–¥–æ–ª–∂–µ–Ω –Ω–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ –≤ Postgres).
3.  –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–∑ CRM.
